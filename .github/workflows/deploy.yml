name: Deploy to Raspberry Pi

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Tailscale
        uses: tailscale/github-action@v3
        with:
          authkey: ${{ secrets.TAILSCALE_AUTH_KEY }}

      - name: Build project
        run: |
          npm install
          npm run build

      - name: Copy files to Raspberry Pi
        run: |
          scp -o StrictHostKeyChecking=no -r ./dist alienriquebm@${{ secrets.TAILSCALE_RPI_IP }}:/home/alienriquebm/docker/dev-portfolio/sature

      - name: Restart Docker container
        run: |
          ssh -o StrictHostKeyChecking=no alienriquebm@${{ secrets.TAILSCALE_RPI_IP }} << 'EOF'
            cd /home/alienriquebm/docker/dev-portfolio/sature
            docker compose down
            docker compose up -d
          EOF
